<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      6.6.&nbsp;创建必要的文件和符号链接
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20121015">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20121015
      </h4>
      <h3>
        第&nbsp;6&nbsp;章&nbsp;安装基本系统软件
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title="创建目录">上一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-3.6.2 API 头文件">下一页</a>
          <p>
            Linux-3.6.2 API 头文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "第&nbsp;6&nbsp;章&nbsp;安装基本系统软件">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121015">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-system-createfiles" name="ch-system-createfiles"></a>6.6.
        创建必要的文件和符号链接
      </h1>
      <p>
        有些程序使用不可更改的路径指向现在还没有到位的程序。为了满足这些程序，创建一些符号链接，在本章中安装对应的软件之后它们会被真正的文件替代：
      </p>
      <pre class="userinput">
<kbd class="command">ln -sv /tools/bin/{bash,cat,echo,pwd,stty} /bin
ln -sv /tools/bin/perl /usr/bin
ln -sv /tools/lib/libgcc_s.so{,.1} /usr/lib
ln -sv /tools/lib/libstdc++.so{,.6} /usr/lib
sed 's/tools/usr/' /tools/lib/libstdc++.la &gt; /usr/lib/libstdc++.la
ln -sv bash /bin/sh</kbd>
</pre>
      <p>
        正确的 Linux 系统在 <code class="filename">/etc/mtab</code>
        文件中维护一个列表，列出挂载的文件系统。通常它会在我们挂载新的文件系统的时候创建。因为我们不会在 chroot
        环境中挂载任何文件系统，创建一个空文件供要求 <code class="filename">/etc/mtab</code>
        存在的工具使用：
      </p>
      <pre class="userinput">
<kbd class="command">touch /etc/mtab</kbd>
</pre>
      <p>
        为了让 <code class="systemitem">root</code> 用户能够登录并且要 “<span class=
        "quote">root</span>” 这个名字被识别，在 <code class=
        "filename">/etc/passwd</code> 和 <code class=
        "filename">/etc/group</code> 这两个文件中就要有对应的条目存在。
      </p>
      <p>
        运行一下命令创建 <code class="filename">/etc/passwd</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; /etc/passwd &lt;&lt; "EOF"
<code class="literal">root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/dev/null:/bin/false
nobody:x:99:99:Unprivileged User:/dev/null:/bin/false</code>
EOF</kbd>
</pre>
      <p>
        <code class="systemitem">root</code> 用户的实际密码 (这里的 “<span class=
        "quote">x</span>” 只用作占位符) 稍后再设置。
      </p>
      <p>
        运行以下命令创建 <code class="filename">/etc/group</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; /etc/group &lt;&lt; "EOF"
<code class="literal">root:x:0:
bin:x:1:
sys:x:2:
kmem:x:3:
tape:x:4:
tty:x:5:
daemon:x:6:
floppy:x:7:
disk:x:8:
lp:x:9:
dialout:x:10:
audio:x:11:
video:x:12:
utmp:x:13:
usb:x:14:
cdrom:x:15:
mail:x:34:
nogroup:x:99:</code>
EOF</kbd>
</pre>
      <p>
        创建的组并不是任何标准的一部分——它们一部分是本章中 Udev 配置的要求，另一部分是一些已有发行版的惯例。Linux 基础标准
        (LSB，位于 <a class="ulink" href=
        "http://www.linuxbase.org">http://www.linuxbase.org</a>) 只推荐
        <code class="systemitem">root</code> 组的 ID 为 0 并且 <code class=
        "systemitem">bin</code> 组的 ID 为 1。所有其他组的名称和 ID
        都可以由系统管理员自由选择，因为写得好的程序会使用组的名字而不是 ID。
      </p>
      <p>
        要移除 “<span class="quote">I have no name!</span>” 这个提示符，启动一个新的prompt,
        start a new shell. Since a full Glibc was installed in <a class=
        "xref" href="../chapter05/chapter05.html" title=
        "第&nbsp;5&nbsp;章&nbsp;搭建临时系统">第五章</a> and the <code class=
        "filename">/etc/passwd</code> and <code class=
        "filename">/etc/group</code> files have been created, user name and
        group name resolution will now work:
      </p>
      <pre class="userinput">
<kbd class="command">exec /tools/bin/bash --login +h</kbd>
</pre>
      <p>
        Note the use of the <em class="parameter"><code>+h</code></em>
        directive. This tells <span class=
        "command"><strong>bash</strong></span> not to use its internal path
        hashing. Without this directive, <span class=
        "command"><strong>bash</strong></span> would remember the paths to
        binaries it has executed. To ensure the use of the newly compiled
        binaries as soon as they are installed, the <em class=
        "parameter"><code>+h</code></em> directive will be used for the
        duration of this chapter.
      </p>
      <p>
        The <span class="command"><strong>login</strong></span>, <span class=
        "command"><strong>agetty</strong></span>, and <span class=
        "command"><strong>init</strong></span> programs (and others) use a
        number of log files to record information such as who was logged into
        the system and when. However, these programs will not write to the
        log files if they do not already exist. Initialize the log files and
        give them proper permissions:
      </p>
      <pre class="userinput">
<kbd class="command">touch /var/log/{btmp,lastlog,wtmp}
chgrp -v utmp /var/log/lastlog
chmod -v 664  /var/log/lastlog
chmod -v 600  /var/log/btmp</kbd>
</pre>
      <p>
        The <code class="filename">/var/log/wtmp</code> file records all
        logins and logouts. The <code class=
        "filename">/var/log/lastlog</code> file records when each user last
        logged in. The <code class="filename">/var/log/btmp</code> file
        records the bad login attempts.
      </p>
      <div class="admon note">
        <img alt="[注意]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          The <code class="filename">/run/utmp</code> file records the users
          that are currently logged in. This file is created dynamically in
          the boot scripts.
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title="创建目录">上一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-3.6.2 API 头文件">下一页</a>
          <p>
            Linux-3.6.2 API 头文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "第&nbsp;6&nbsp;章&nbsp;安装基本系统软件">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121015">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
