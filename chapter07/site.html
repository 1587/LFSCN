<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.12.&nbsp;rc.site 文件
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20121015">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20121015
      </h4>
      <h3>
        第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="sysklogd.html" title=
          "配置 sysklogd 脚本">上一页</a>
          <p>
            配置 sysklogd 脚本
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="profile.html" title=
          "Bash Shell 启动文件">下一页</a>
          <p>
            Bash Shell 启动文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121015">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-scripts-site" name="ch-scripts-site"></a>7.12. rc.site 文件
      </h1>
      <p>
        可选的 <code class="filename">/etc/sysconfig/rc.site</code>
        文件包含给每个引导脚本自动进行的设置。它也可以用于指定 <code class=
        "filename">/etc/sysconfig/</code> 中 <code class=
        "filename">hostname</code>、<code class="filename">console</code> 和
        <code class="filename">clock</code> 文件中指定的值。如果关联的变量在这些独立的文件和
        <code class="filename">rc.site</code> 中都存在，以脚本指定的文件为准。
      </p>
      <p>
        <code class="filename">rc.site</code> 还包括可以自定义引导进程其他方面的参数。设置 IPROMPT
        变量会启用引导脚本的选择性运行。其他选项在文件中的注释有介绍。此文件的默认版本如下：
      </p>
      <pre class="auto">
# rc.site
# Optional parameters for boot scripts.

# Distro Information
# These values, if specified here, override the defaults
#DISTRO="Linux From Scratch" # The distro name
#DISTRO_CONTACT="lfs-dev@linuxfromscratch.org" # Bug report address
#DISTRO_MINI="LFS" # Short name used in filenames for distro config

# Define custom colors used in messages printed to the screen

# Please consult `man console_codes` for more information
# under the "ECMA-48 Set Graphics Rendition" section
#
# Warning: when switching from a 8bit to a 9bit font,
# the linux console will reinterpret the bold (1;) to
# the top 256 glyphs of the 9bit font.  This does
# not affect framebuffer consoles

# These values, if specified here, override the defaults
#BRACKET="\\033[1;34m" # Blue
#FAILURE="\\033[1;31m" # Red
#INFO="\\033[1;36m"    # Cyan
#NORMAL="\\033[0;39m"  # Grey
#SUCCESS="\\033[1;32m" # Green
#WARNING="\\033[1;33m" # Yellow

# Use a colored prefix
# These values, if specified here, override the defaults
#BMPREFIX="     "
#SUCCESS_PREFIX="${SUCCESS}  *  ${NORMAL}"
#FAILURE_PREFIX="${FAILURE}*****${NORMAL}"
#WARNING_PREFIX="${WARNING} *** ${NORMAL}"

# Interactive startup
#IPROMPT="yes" # Whether to display the interactive boot prompt
#itime="3"    # The amount of time (in seconds) to display the prompt

# The total length of the distro welcome string, without escape codes
#wlen=$(echo "Welcome to ${DISTRO}" | wc -c )
#welcome_message="Welcome to ${INFO}${DISTRO}${NORMAL}"

# The total length of the interactive string, without escape codes
#ilen=$(echo "Press 'I' to enter interactive startup" | wc -c )
#i_message="Press '${FAILURE}I${NORMAL}' to enter interactive startup"

# Set scripts to skip the file system check on reboot
#FASTBOOT=yes

# Skip reading from the console
#HEADLESS=yes

# Speed up boot without waiting for settle in udev_retry
#OMIT_UDEV_RETRY_SETTLE=yes

# Write out fsck progress if yes
#VERBOSE_FSCK=no

# Speed up boot without waiting for settle in udev
#OMIT_UDEV_SETTLE=y

# Speed up boot without waiting for settle in udev_retry
#OMIT_UDEV_RETRY_SETTLE=yes

# Skip cleaning /tmp if yes
#SKIPTMPCLEAN=no

# For setclock
#UTC=1
#CLOCKPARAMS=

# For consolelog
#LOGLEVEL=5

# For network
#HOSTNAME=mylfs

# Delay between TERM and KILL signals at shutdown
#KILLDELAY=3

# Optional sysklogd parameters
#SYSKLOGD_PARMS="-m 0"

# Console parameters
#UNICODE=1
#KEYMAP="de-latin1"
#KEYMAP_CORRECTIONS="euro2"
#FONT="lat0-16 -m 8859-15"
#LEGACY_CHARSET=

</pre>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          7.12.1. 自定义引导和关机脚本
        </h2>
        <p>
          LFS 引导脚本以比较高效的方式引导和关闭序同，但是你仍然可以在 rc.site
          文件中进行几项调校使它更快或者按照你的喜好调节信息。要如此做，调节以上的 <code class=
          "filename">/etc/sysconfig/rc.site</code> 文件。
        </p>
        <div class="itemizedlist">
          <ul>
            <li>
              <p>
                在引导脚本 <code class="filename">udev</code> 中调用了 <span class=
                "command"><strong>udev
                settle</strong></span>，需要一定时间才能完成。这个时间是否需要取决于系统上出现的设备。如果你只有简单分区和一块以太网卡，引导进程可能就不必等待这一命令。要跳过之，设置变量
                OMIT_UDEV_SETTLE=y。
              </p>
            </li>
            <li>
              <p>
                引导脚本 <code class="filename">udev_retry</code> 默认也会运行
                <span class="command"><strong>udev
                settle</strong></span>。此命令只在 <code class=
                "filename">/var</code> 目录独立挂载时必须。这是因为时钟需要 <code class=
                "filename">/var/lib/hwclock/adjtime</code> 这个文件。其他的自定义可能也要等待
                udev 完成，但是在很多安装副本中并不是必须的。要跳过此命令，设置变量
                OMIT_UDEV_RETRY_SETTLE=y。
              </p>
            </li>
            <li>
              <p>
                文件系统检查默认是静默的。看起来是在引导过程中出现了一次延迟。要打开 <span class=
                "command"><strong>fsck</strong></span> 的输出，设置变量
                VERBOSE_FSCK=y。
              </p>
            </li>
            <li>
              <p>
                在重新引导过程中你可能会想要完全跳过文件系统检查，即 <span class=
                "command"><strong>fsck</strong></span>。要如此做，要么创建文件
                <code class="filename">/fastboot</code>，要么在重新引导系统时使用命令
                <span class="command"><strong>/sbin/shutdown -f -r
                now</strong></span>。另一方面，你也可以强制检查所有的文件系统，创建 <code class=
                "filename">/forcefsck</code> 或者运行 <span class=
                "command"><strong>shutdown</strong></span> 时传递 <em class=
                "parameter"><code>-F</code></em> 参数而不是 <em class=
                "parameter"><code>-f</code></em>。
              </p>
              <p>
                设置变量 FASTBOOT=y 会在引导过程中禁用 <span class=
                "command"><strong>fsck</strong></span> 直到被移除为止。不推荐长期如此。
              </p>
            </li>
            <li>
              <p>
                通常在 <code class="filename">/tmp</code>
                目录中的所有文件在引导时都会删除。由于出现的文件或目录的数量不同，这一步会在引导过程中产生明显延迟。要跳过移除这些文件，设置变量
                SKIPTMPCLEAN=y。
              </p>
            </li>
            <li>
              <p>
                在关机过程中 <span class="command"><strong>init</strong></span>
                程序会给它启动的每个程序 (例如 agetty) 发送一个 TERM 信号，等待一个设置的时间 (默认 3
                秒)，然后给每个进程发送一个 KILL 信号并且再次等待。此进程在 <span class=
                "command"><strong>sendsignals</strong></span>
                中对于每个没有被自己的脚本关闭的程序循环进行。<span class=
                "command"><strong>init</strong></span> 的延迟可以通过传递一个参数来设置。例如要移除
                <span class="command"><strong>init</strong></span>
                的延迟，在关机护着重新引导时传递 -t0 参数 (如 <span class=
                "command"><strong>/sbin/shutdown -t0 -r
                now</strong></span>)。<span class=
                "command"><strong>sendsignals</strong></span> 脚本的延迟可以通过设置参数
                KILLDELAY=0 来跳过。
              </p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="sysklogd.html" title=
          "配置 sysklogd 脚本">上一页</a>
          <p>
            配置 sysklogd 脚本
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="profile.html" title=
          "Bash Shell 启动文件">下一页</a>
          <p>
            Bash Shell 启动文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121015">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
