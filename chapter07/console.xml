<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-scripts-console">
  <?dbhtml filename="console.html"?>

  <title>配置Linux控制台</title>

  <indexterm zone="ch-scripts-console">
    <primary sortas="d-console">console</primary>
    <secondary>configuring</secondary>
  </indexterm>

  <para>这一章节谈论如何设置 <command>console</command> 启动脚本。包括正确配置键盘表，控制台字体，系统启动级别。如果不使用非ASCII字符且键盘是标准US键盘的话，本章节的大部分内容可以跳过。没有相应的配置文件的话，（或者 <filename>rc.site</filename> 文件中等价的设置），<command>console</command> 启动脚本不会做任何事情。</para>

  <para><command>console</command> 脚本读取 <filename>/etc/sysconfig/console</filename> 文件来获取相关的配置信息，决定使用哪个键盘映射表和屏幕字体。关于如何让控制台支持其他语言可以在下面的地址找着答案 <ulink
  url="http://www.tldp.org/HOWTO/HOWTO-INDEX/other-lang.html"/>。如果还有疑问，可以查看 <filename class="directory">/lib/kbd</filename> 文件夹的内容来获取合法的键盘映射表和屏幕字体。还可以查看 <filename>loadkeys(1)</filename> 和 <filename>setfont(8)</filename>  来确定如何使用正确的参数运行这些程序。</para>

  <para><filename>/etc/sysconfig/console</filename> 应该包含如下形式的行：变量="值"。下面是合法的变量：</para>

  <variablelist>

    <varlistentry>
      <term>LOGLEVEL</term>
      <listitem>
        <para>这个变量可以像 <command>dmesg</command> 命令一样定义内核消息级别（内核会把根据这个级别确定的一类内核信息发送到控制台）。从"1"（没有消息）到"8"都是合法的等级。默认的等级是"7"。</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>KEYMAP</term>
      <listitem>
        <para>这个变量定义了 <command>loadkeys</command> 程序的参数，通常是你的键盘映射表的名字，例如，<quote>es</quote>。如果这个变量没有设置，启动脚本不会运行 <command>loadkeys</command> 程序，默认的键盘映射表会启用。</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>KEYMAP_CORRECTIONS</term>
      <listitem>
        <para>这个（很少用到的）变量指定第二次调用 <command>loadkeys</command> 程序时传递给它的参数。这在标准键盘表并不完全匹配你的键盘，需要做小幅调整时非常有用。例如，为了加入Euro标志到一个通常并不包含它的键盘映射表中，可以将这个变量设置成<quote>euro2</quote>。</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>FONT</term>
      <listitem>
        <para>这个变量指定调用 <command>setfont</command> 程序的参数。通常包括字体名称，<quote>-m</quote>，需要加载的被应用程序使用的字符集（application character map）。例如,为了加载<quote>lat1-16</quote>字体和<quote>8859-1</quote>字符集（美国中较为常用），<!-- because of the copyright sign -->设置这个变量为<quote>lat1-16 -m 8859-1</quote>。
        In UTF-8 mode, the kernel uses the application character map for
        conversion of composed 8-bit key codes in the keymap to UTF-8, and thus
        the argument of the "-m" parameter should be set to the encoding of the
        composed key codes in the keymap.</para>

      </listitem>
    </varlistentry>

    <varlistentry>
      <term>UNICODE</term>
      <listitem>
        <para>将这个变量设置为<quote>1</quote>，<quote>yes</quote>或<quote>true</quote>可以让控制台运行在UTF-8模式。这对基于UTF-8的 locale 很有用，但是对其他的有害。</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>LEGACY_CHARSET</term>
      <listitem>
        <para>For many keyboard layouts, there is no stock Unicode keymap in
        the Kbd package. The <command>console</command> bootscript will
        convert an available keymap to UTF-8 on the fly if this variable is
        set to the encoding of the available non-UTF-8 keymap.</para>
      </listitem>
    </varlistentry>

  </variablelist>

  <para>Some examples:</para>

  <itemizedlist>

    <listitem>
      <para>For a non-Unicode setup, only the KEYMAP and FONT variables are
      generally needed. E.g., for a Polish setup, one would use:</para>

<screen role="nodump"><userinput>cat &gt; /etc/sysconfig/console &lt;&lt; "EOF"
<literal># Begin /etc/sysconfig/console

KEYMAP="pl2"
FONT="lat2a-16 -m 8859-2"

# End /etc/sysconfig/console</literal>
EOF</userinput></screen>
    </listitem>

    <listitem>
      <para>As mentioned above, it is sometimes necessary to adjust a
      stock keymap slightly. The following example adds the Euro symbol to the
      German keymap:</para>

<screen role="nodump"><userinput>cat &gt; /etc/sysconfig/console &lt;&lt; "EOF"
<literal># Begin /etc/sysconfig/console

KEYMAP="de-latin1"
KEYMAP_CORRECTIONS="euro2"
FONT="lat0-16 -m 8859-15"

# End /etc/sysconfig/console</literal>
EOF</userinput></screen>
    </listitem>

    <listitem>
      <para>The following is a Unicode-enabled example for Bulgarian, where a
      stock UTF-8 keymap exists:</para>

<screen role="nodump"><userinput>cat &gt; /etc/sysconfig/console &lt;&lt; "EOF"
<literal># Begin /etc/sysconfig/console

UNICODE="1"
KEYMAP="bg_bds-utf8"
FONT="LatArCyrHeb-16"

# End /etc/sysconfig/console</literal>
EOF</userinput></screen>
    </listitem>

    <listitem>
      <para>Due to the use of a 512-glyph LatArCyrHeb-16 font in the previous
      example, bright colors are no longer available on the Linux console unless
      a framebuffer is used. If one wants to have bright colors without
      framebuffer and can live without characters not belonging to his language,
      it is still possible to use a language-specific 256-glyph font, as
      illustrated below:</para>

<screen role="nodump"><userinput>cat &gt; /etc/sysconfig/console &lt;&lt; "EOF"
<literal># Begin /etc/sysconfig/console

UNICODE="1"
KEYMAP="bg_bds-utf8"
FONT="cyr-sun16"

# End /etc/sysconfig/console</literal>
EOF</userinput></screen>
    </listitem>

    <listitem>
      <para>The following example illustrates keymap autoconversion from
      ISO-8859-15 to UTF-8 and enabling dead keys in Unicode mode:</para>

<screen role="nodump"><userinput>cat &gt; /etc/sysconfig/console &lt;&lt; "EOF"
<literal># Begin /etc/sysconfig/console

UNICODE="1"
KEYMAP="de-latin1"
KEYMAP_CORRECTIONS="euro2"
LEGACY_CHARSET="iso-8859-15"
FONT="LatArCyrHeb-16 -m 8859-15"

# End /etc/sysconfig/console</literal>
EOF</userinput></screen>
    </listitem>

    <listitem>
      <para>Some keymaps have dead keys (i.e., keys that don't produce a
      character by themselves, but put an accent on the character produced
      by the next key) or define composition rules (such as: <quote>press
      Ctrl+. A E to get &AElig;</quote> in the default keymap).
      Linux-&linux-version; interprets dead keys and composition rules in the
      keymap correctly only when the source characters to be composed together
      are not multibyte. This deficiency doesn't affect keymaps for European
      languages, because there accents are added to unaccented ASCII
      characters, or two ASCII characters are composed together. However, in
      UTF-8 mode it is a problem, e.g., for the Greek language, where one
      sometimes needs to put an accent on the letter <quote>alpha</quote>.
      The solution is either to avoid the use of UTF-8, or to install the
      X window system that doesn't have this limitation in its input
      handling.</para>
    </listitem>

    <listitem>
      <para>对于中文，日文，棒子文及一些其他的语言的用户，Linux的控制台无法通过简单配置显示他们需要的字体。需要这些语言的用户需要安装 X Window 系统，包含这些语言的字符的字体，黑又合适的输入法（例如，SCIM，它支持很多种语言）。</para>
    </listitem>

  </itemizedlist>

  <!-- Added because folks keep posting their console file with X questions
  to blfs-support list -->
  <note>
    <para>The <filename>/etc/sysconfig/console</filename> file only controls the    Linux text console localization. It has nothing to do with setting the
    proper keyboard layout and terminal fonts in the X Window System, with ssh
    sessions or with a serial console. In such situations, limitations mentioned
    in the last two list items above do not apply.</para>
  </note>

</sect1>
