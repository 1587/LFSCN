<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.13.&nbsp;Bash Shell 启动文件
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20121103">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20121103
      </h4>
      <h3>
        第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="site.html" title="rc.site 文件">上一页</a>
          <p>
            rc.site 文件
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="inputrc.html" title=
          "创建 /etc/inputrc 文件">下一页</a>
          <p>
            创建 /etc/inputrc 文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121103">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-scripts-profile" name="ch-scripts-profile"></a>7.13. Bash
        Shell 启动文件
      </h1>
      <p>
        shell 程序 <span class="command"><strong>/bin/bash</strong></span>
        (以下简称 “<span class="quote">shell</span>”)
        使用一系列起始文件协助创建运行的环境。每个文件都有特定的用途，可能会以不同方式影响输入和交互环境。位于 <code class=
        "filename">/etc</code> 目录中的文件提供全局设置。如果在主目录中有等价的文件，它可能会覆盖全局设置。
      </p>
      <p>
        一个交互的登录 shell 在成功的以 <span class=
        "command"><strong>/bin/login</strong></span> 读取 <code class=
        "filename">/etc/passwd</code> 文件的登录过后启动。一个交互的非登录 shell 在命令行中启动 (例如
        <code class="prompt">[prompt]$</code><span class=
        "command"><strong>/bin/bash</strong></span>)。在 shell 脚本运行的时候通常会有非交互
        shell 出现，因为不等待用户输入命令而成为非交互的。
      </p>
      <p>
        要获取更多信息，参考 <span class="command"><strong>info bash</strong></span> 中的
        <span class="emphasis"><em>Bash Startup Files and Interactive
        Shells</em></span> 一节。
      </p>
      <p>
        <code class="filename">/etc/profile</code> 文件和 <code class=
        "filename">~/.bash_profile</code> 文件在 shell 作为交互登录 shell 调用的时候会被读取。
      </p>
      <p>
        以下基础的 <code class="filename">/etc/profile</code> 文件设置了 NLS
        必须的一些环境变量。正确设置之使得：
      </p>
      <div class="itemizedlist">
        <ul>
          <li>
            <p>
              程序的输出翻译为本土语言
            </p>
          </li>
          <li>
            <p>
              正确将字符分类为字母、数字和其他类型。这对于 <span class=
              "command"><strong>bash</strong></span> 要正确接受非英语区域数据中的非 ASC
              字符来说是必要的
            </p>
          </li>
          <li>
            <p>
              国家的正确字母表顺序
            </p>
          </li>
          <li>
            <p>
              合适的默认纸张尺寸
            </p>
          </li>
          <li>
            <p>
              正确格式化货币、时间和日期值
            </p>
          </li>
        </ul>
      </div>
      <p>
        将以下的 <em class="replaceable"><code>&lt;ll&gt;</code></em>
        替换为所在语言和国家的二字码 (例如 “<span class="quote">zh</span>”) 和 <em class=
        "replaceable"><code>&lt;CN&gt;</code></em>。<em class=
        "replaceable"><code>&lt;charmap&gt;</code></em>
        应该替换为选中区域数据的正规字符映射。可选的修改，例如 “<span class="quote">@euro</span>” 也可以存在。
      </p>
      <p>
        要列出 Glibc 支持的所有区域数据，运行以下命令：
      </p>
      <pre class="userinput">
<kbd class="command">locale -a</kbd>
</pre>
      <p>
        字符映射可能会有多个别名。某些应用程序无法正确处理同义 (例如要求 “<span class="quote">UTF-8</span>”
        必须写成 “<span class="quote">UTF-8</span>” 而不允许写成 “<span class=
        "quote">utf8</span>”)，所以大多数情况下选择特定区域数据的正规名称是最安全的。要获知正规名称，运行以下命令，其中
        <em class="replaceable"><code>&lt;locale&gt;</code></em> 要替换为
        <span class="command"><strong>locale -a</strong></span>
        对于需要的区域数据提供的输出。
      </p>
      <pre class="userinput">
<kbd class="command">LC_ALL=<em class=
"replaceable"><code>&lt;locale&gt;</code></em> locale charmap</kbd>
</pre>
      <p>
        对于 “<span class="quote">zh_CN.utf8</span>” 这个区域数据，以上命令将会输出：
      </p>
      <pre class="screen">
<code class="computeroutput">UTF-8</code>
</pre>
      <p>
        这会导致最终的区域数据设置为 “<span class=
        "quote">zh_CN.UTF-8</span>”。以上试探找到的区域数据在添加到 Bash 的起始文件之前要经过测试是很重要的：
      </p>
      <pre class="userinput">
<kbd class="command">LC_ALL=&lt;locale&gt; locale language
LC_ALL=&lt;locale&gt; locale charmap
LC_ALL=&lt;locale&gt; locale int_curr_symbol
LC_ALL=&lt;locale&gt; locale int_prefix</kbd>
</pre>
      <p>
        以上命令应该打印语言名称、字符编码、本地货币和电话号码前缀。如果其中任何一项失败并且输出类似以下的消息，就意味着你的区域数据要么在第六章中没有安装，要不不被
        Glibc 的默认安装支持。
      </p>
      <pre class="screen">
<code class=
"computeroutput">locale: Cannot set LC_* to default locale: No such file or directory</code>
</pre>
      <p>
        如果如此，你应该使用 <span class="command"><strong>localedef</strong></span>
        命令安装需要的区域数据，否则就应该考虑选择另外一个。以后的指令假定 Glibc 并不会输出类似的错误消息。
      </p>
      <p>
        LFS 以外的某些程序包可能也缺乏对选中的区域数据的支持。一个例子就是 X 库 (X
        窗口系统的一部分)，在区域数据与其内部文件中的任何一个字符集都不准确匹配时会输出以下错误消息：
      </p>
      <pre class="screen">
<code class=
"computeroutput">Warning: locale not supported by Xlib, locale set to C</code>
</pre>
      <p>
        在某些情况下 Xlib 期待字符集以大写和连字符表示。例如 “<span class="quote">ISO-8859-1</span>”
        而不是 “<span class=
        "quote">utf8</span>”。它还可以通过移除区域数据定义中的字符映射部分来指定正确的值。可以通过对两个区域数据分别运行
        <span class="command"><strong>locale charmap</strong></span> 来检查。例如
        “<span class="quote">de_DE.ISO-8859-15@euro</span>” 需要改为
        “<span class="quote">de_DE@euro</span>” 才会被 Xlib 识别。
      </p>
      <p>
        其他程序包也可能在区域数据名称不合要求时功能不正确 (但不一定会显示错误消息)。这种起那况下，研究一下其他 Linux
        发行版如何支持你的区域数据可能会提供一些有用的信息。
      </p>
      <p>
        一旦正确的区域数据设置确定，创建 <code class="filename">/etc/profile</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; /etc/profile &lt;&lt; "EOF"
<code class="literal"># Begin /etc/profile

export LANG=<em class=
"replaceable"><code>&lt;ll&gt;_&lt;CC&gt;.&lt;charmap&gt;&lt;@modifier&gt;</code></em>

# End /etc/profile</code>
EOF</kbd>
</pre>
      <p>
        “<span class="quote">C</span>” (默认) 和 “<span class=
        "quote">en_US</span>” (对美国英语用户的推荐) 区域数据是不同的。“<span class=
        "quote">C</span>” 使用 US-ASCII 7 位字符集，会将最高位为 1 的字节视为无效字符。这也就是
        <span class="command"><strong>ls</strong></span>
        等命令在该区域数据中将其替换为问号的原因。另外，试图以 Mutt 或 Pine 发送带有此类字符的邮件会导致发送出不符合 RFC 的消息
        (发出的邮件的字符集会被表示为 “<span class="quote">unknown
        8-bit</span>”)。所以，若不是确定不会需要 8 位字符，就不要使用 “<span class=
        "quote">C</span>” 区域数据。
      </p>
      <p>
        基于 UTF-8 的区域数据在很多程序中的支持都不好。相关工作正在进行，参见 <a class="ulink" href=
        "http://www.linuxfromscratch.org/blfs/view/svn/introduction/locale-issues.html">
        http://www.linuxfromscratch.org/blfs/view/svn/introduction/locale-issues.html</a>。
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="site.html" title="rc.site 文件">上一页</a>
          <p>
            rc.site 文件
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="inputrc.html" title=
          "创建 /etc/inputrc 文件">下一页</a>
          <p>
            创建 /etc/inputrc 文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121103">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
