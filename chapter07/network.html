<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.2.&nbsp;通用网络配置
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20120415">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20120415
      </h4>
      <h3>
        第&nbsp;7&nbsp;章&nbsp;设置系统启动脚本
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title="介绍">上一页</a>
          <p>
            介绍
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="hosts.html" title=
          "Customizing the /etc/hosts File">下一页</a>
          <p>
            Customizing the /etc/hosts File
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统启动脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20120415">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-scripts-network" name="ch-scripts-network"></a>7.2. 通用网络配置
      </h1>
      <p>
        这一章节仅在需要配置网卡的时候有用。
      </p>
      <p>
        如果不需要使用一个网卡，那么似乎不需要创建任何跟网卡相关的配置文件。如果真的是这样，请删除所有启动级别文件夹 (<code class=
        "filename">/etc/rc.d/rc*.d</code>) 中的 <code class=
        "filename">network</code>符号链接.
      </p>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          7.2.1. 给网络接口创建稳定的名称
        </h2>
        <p>
          如果这个系统只需要设置一个网络接口，这一节是可选的，即时这永远也不会出错。在许多情况下
          (例如一个有无线接口和有线接口的笔记本电脑)，完成本节的配置是很重要的。
        </p>
        <p>
          通过 Udev
          和网卡驱动模块，网络接口的编号在重启之后并不是不变的，因为这些驱动会并行加载，也就是说是顺序随机。例如，一个拥有两块分别由 Intel
          和 Realtek 制造的网卡的电脑，Intel 网卡可能会成为 <code class=
          "filename">eth0</code>，Realtek 网卡会成为<code class=
          "filename">eth1</code>。在某些情况下，重启之后他们的标号会互换。为了避免这种情况，Udev
          使用一个脚本和一些规则，根据网卡的 MAC 地址来分配稳定的名称。
        </p>
        <p>
          提前设定好规则来确保同一个设备分配到同一个名称，首先：
        </p>
        <pre class="userinput">
<kbd class="command">for NIC in /sys/class/net/* ; do
    INTERFACE=${NIC##*/} udevadm test --action=add $NIC
done</kbd>
</pre>
        <p>
          现在，查看 <code class=
          "filename">/etc/udev/rules.d/70-persistent-net.rules</code>
          文件，查看你的网络设备们分别对应到哪些名称：
        </p>
        <pre class="userinput">
<kbd class="command">cat /etc/udev/rules.d/70-persistent-net.rules</kbd>
</pre>
        <p>
          这个文件中，每个 NIC 由一行注释紧接两行内容表示。第一行是对硬件 ID 的描述 (例如，如果是一张 PCI 卡，它的 PCI
          销售方和设备 ID)，如果他的驱动程序可以找到，会写在圆括号中。硬件 ID
          和驱动程序都不是如何分配标识符的标准，他们仅供参考。第二行是 Udev 用来匹配 NIC 的规则，以此来分配标识符。
        </p>
        <p>
          Udev 的所有规则由关键字，由逗号和可选的空格隔开。如下是这些关键字和其说明：
        </p>
        <div class="itemizedlist">
          <ul>
            <li>
              <p>
                <code class="literal">SUBSYSTEM=="net"</code> - 此项告诉 Udev
                忽略不是网卡的设备。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">ACTION=="add"</code> - 此项告诉 Udev
                对非添加操作的 Udev 事件 (uevent) 忽略此规则 (“移除” 和 “改动”
                事件依然会被触发，但是不需要重命名网卡接口)。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">DRIVERS=="?*"</code> - 此项存在使得 Udev 忽略
                VLAN 或者桥接子接口 (因为这些子接口没有驱动)。这些子接口会被跳过以防名称与父设备冲突。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">ATTR{address}</code> - The value of
                this key is the NIC's MAC address.
              </p>
            </li>
            <li>
              <p>
                <code class="literal">ATTR{type}=="1"</code> - This ensures
                the rule only matches the primary interface in the case of
                certain wireless drivers, which create multiple virtual
                interfaces. The secondary interfaces are skipped for the same
                reason that VLAN and bridge sub-interfaces are skipped: there
                would be a name collision otherwise.
              </p>
            </li>
            <li>
              <p>
                <code class="literal">KERNEL=="eth*"</code> - This key was
                added to the Udev rule generator to handle machines that have
                multiple network interfaces, all with the same MAC address
                (the PS3 is one such machine). If the independent interfaces
                have different basenames, this key will allow Udev to tell
                them apart. This is generally not necessary for most Linux
                From Scratch users, but does not hurt.
              </p>
            </li>
            <li>
              <p>
                <code class="literal">NAME</code> - The value of this key is
                the name that Udev will assign to this interface.
              </p>
            </li>
          </ul>
        </div>
        <p>
          The value of <code class="literal">NAME</code> is the important
          part. Make sure you know which name has been assigned to each of
          your network cards before proceeding, and be sure to use that
          <code class="literal">NAME</code> value when creating your
          configuration files below.
        </p>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          7.2.2. Creating Network Interface Configuration Files
        </h2>
        <p>
          Which interfaces are brought up and down by the network script
          depends on the files in <code class=
          "filename">/etc/sysconfig/</code>. This directory should contain a
          file for each interface to be configured, such as <code class=
          "filename">ifconfig.xyz</code>, where “<span class=
          "quote">xyz</span>” is meaningful to the administrator such as the
          device name (e.g. eth0). Inside this file are attributes to this
          interface, such as its IP address(es), subnet masks, and so forth.
          It is necessary that the stem of the filename be <span class=
          "emphasis"><em>ifconfig</em></span>.
        </p>
        <p>
          The following command creates a sample file for the <span class=
          "emphasis"><em>eth0</em></span> device with a static IP address:
        </p>
        <pre class="userinput">
<kbd class="command">cd /etc/sysconfig/
cat &gt; ifconfig.eth0 &lt;&lt; "EOF"
<code class="literal">ONBOOT=yes
IFACE=eth0
SERVICE=ipv4-static
IP=192.168.1.1
GATEWAY=192.168.1.2
PREFIX=24
BROADCAST=192.168.1.255</code>
EOF</kbd>
</pre>
        <p>
          The values of these variables must be changed in every file to
          match the proper setup.
        </p>
        <p>
          If the <code class="envar">ONBOOT</code> variable is set to
          “<span class="quote">yes</span>” the network script will bring up
          the Network Interface Card (NIC) during booting of the system. If
          set to anything but “<span class="quote">yes</span>” the NIC will
          be ignored by the network script and not be automatically brought
          up. The interface can be manually started or stopped with the
          <span class="command"><strong>ifup</strong></span> and <span class=
          "command"><strong>ifdown</strong></span> commands.
        </p>
        <p>
          The <code class="envar">IFACE</code> variable defines the interface
          name, for example, eth0. It is required for all network device
          configuration files.
        </p>
        <p>
          The <code class="envar">SERVICE</code> variable defines the method
          used for obtaining the IP address. The LFS-Bootscripts package has
          a modular IP assignment format, and creating additional files in
          the <code class="filename">/lib/services/</code> directory allows
          other IP assignment methods. This is commonly used for Dynamic Host
          Configuration Protocol (DHCP), which is addressed in the BLFS book.
        </p>
        <p>
          The <code class="envar">GATEWAY</code> variable should contain the
          default gateway IP address, if one is present. If not, then comment
          out the variable entirely.
        </p>
        <p>
          The <code class="envar">PREFIX</code> variable containis the number
          of bits used in the subnet. Each octet in an IP address is 8 bits.
          If the subnet's netmask is 255.255.255.0, then it is using the
          first three octets (24 bits) to specify the network number. If the
          netmask is 255.255.255.240, it would be using the first 28 bits.
          Prefixes longer than 24 bits are commonly used by DSL and
          cable-based Internet Service Providers (ISPs). In this example
          (PREFIX=24), the netmask is 255.255.255.0. Adjust the <code class=
          "envar">PREFIX</code> variable according to your specific subnet.i
          If omitted, the PREFIX defaults to 24.
        </p>
        <p>
          For more information see the <span class=
          "command"><strong>ifup</strong></span> man page.
        </p>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          <a id="resolv.conf" name="resolv.conf"></a>7.2.3. Creating the
          /etc/resolv.conf File
        </h2>
        <p>
          If the system is going to be connected to the Internet, it will
          need some means of Domain Name Service (DNS) name resolution to
          resolve Internet domain names to IP addresses, and vice versa. This
          is best achieved by placing the IP address of the DNS server,
          available from the ISP or network administrator, into <code class=
          "filename">/etc/resolv.conf</code>. Create the file by running the
          following:
        </p>
        <pre class="userinput">
<kbd class="command">cat &gt; /etc/resolv.conf &lt;&lt; "EOF"
<code class="literal"># Begin /etc/resolv.conf

domain <em class="replaceable"><code>&lt;Your Domain Name&gt;</code></em>
nameserver <em class=
"replaceable"><code>&lt;IP address of your primary nameserver&gt;</code></em>
nameserver <em class=
"replaceable"><code>&lt;IP address of your secondary nameserver&gt;</code></em>

# End /etc/resolv.conf</code>
EOF</kbd>
</pre>
        <p>
          The <code class="varname">domain</code> statement can be omitted or
          replaced with a <code class="varname">search</code> statement. See
          the man page for resolv.conf for more details.
        </p>
        <p>
          Replace <em class="replaceable"><code>&lt;IP address of the
          nameserver&gt;</code></em> with the IP address of the DNS most
          appropriate for the setup. There will often be more than one entry
          (requirements demand secondary servers for fallback capability). If
          you only need or want one DNS server, remove the second
          <span class="emphasis"><em>nameserver</em></span> line from the
          file. The IP address may also be a router on the local network.
        </p>
        <div class="admon note">
          <img alt="[注意]" src="../images/note.png" />
          <h3>
            注意
          </h3>
          <p>
            The Google Public IPv4 DNS addresses are 8.8.8.8 and 8.8.4.4.
          </p>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title="介绍">上一页</a>
          <p>
            介绍
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="hosts.html" title=
          "Customizing the /etc/hosts File">下一页</a>
          <p>
            Customizing the /etc/hosts File
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统启动脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20120415">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
