<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.2.&nbsp;通用网络配置
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20121118">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20121118
      </h4>
      <h3>
        第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title="介绍">上一页</a>
          <p>
            介绍
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="hosts.html" title=
          "自定义 /etc/hosts 文件">下一页</a>
          <p>
            自定义 /etc/hosts 文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121118">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-scripts-network" name="ch-scripts-network"></a>7.2. 通用网络配置
      </h1>
      <p>
        本节仅在要配置网卡时应用。
      </p>
      <p>
        如果不会使用网卡，似乎就没有必要创建任何有关网卡的配置文件。在这种情况下就应该在<a class="xref" href=
        "bootscripts.html" title=
        "7.6.&nbsp;LFS-Bootscripts-20121013">第&nbsp;7.6&nbsp;节
        “LFS-Bootscripts-20121013”</a>中安装引导脚本之后从运行级别目录 (<code class=
        "filename">/etc/rc.d/rc*.d</code>) 中移除所有的 <code class=
        "filename">network</code> 符号链接。
      </p>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          <a id="stable-net-names" name="stable-net-names"></a>7.2.1.
          创建网络接口的稳定名称
        </h2>
        <p>
          如果系统上只有一个网络接口，这一节就不是必须的，但是进行这些操作不会有什么错误。很多情况下 (例如有一台无线和一个有线接口的笔记本)
          本节中的配置是必须的。
        </p>
        <p>
          有了 Udev
          和模块化网络驱动，每次重新引导系统之后网络接口的编号默认不是固定的，因为驱动并发加载，也就是说不计顺序。例如在一台有两块分别由
          Intel 和 Realtek 生产的网卡的计算机上，Intel 生产的网卡可能会成为 <code class=
          "filename">eth0</code> 而 Realtek 生产的成为 <code class=
          "filename">eth1</code>。有些情况下重新引导之后网卡的重新编号就会颠倒。要防止这种现象产生，Udev
          带有一个脚本和一些规则来按照 MAC 地址将网卡对应到稳定的名称。
        </p>
        <p>
          这些规则在上一章 <span class="application">udev (systemd)</span>
          的编制指令中已经生成了。检查 <code class=
          "filename">/etc/udev/rules.d/70-persistent-net.rules</code>
          这个文件查找名称和网络设备的对应：
        </p>
        <pre class="userinput">
<kbd class="command">cat /etc/udev/rules.d/70-persistent-net.rules</kbd>
</pre>
        <div class="admon note">
          <img alt="[注意]" src="../images/note.png" />
          <h3>
            注意
          </h3>
          <p>
            在某些情况下，如手动给网卡或 Xen 等虚拟环境分配了 MAC
            地址时，网络规则文件可能就不会生成，因为地址不是固定对应的。这种情况下直接跳到下一节。
          </p>
        </div>
        <p>
          此文件以一个注释块开始，接下来每个 NIC 由两行组成。第一行是注释，显示其硬件 ID (例如 PCI 卡的生产商和设备
          ID)，如果找到了驱动会写在括号中。硬件 ID 和驱动都不会用来确定接口的名称；这些信息仅供参考。第二行是 Udev 匹配此 NIC
          并将其与一个名称实际对应的规则。
        </p>
        <p>
          所有的 Udev 规则都由几个关键字组成，以逗号和可选的空格隔开。此规则的关键字及其解释如下：
        </p>
        <div class="itemizedlist">
          <ul>
            <li>
              <p>
                <code class="literal">SUBSYSTEM=="net"</code> - 此项告诉 Udev
                忽略不是网卡的设备。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">ACTION=="add"</code> - 此项告诉 Udev 对于非添加的
                uevent ("移除" 和 "改变" 这两个 uevents 也会发生，但是无需重命名网络接口) 忽略此规则。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">DRIVERS=="?*"</code> - 此项存在时 Udev 会忽略
                VLAN 或者子接口 (因为子接口没有驱动)。这些子接口要跳过是为了防止名称与其父设备冲突。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">ATTR{address}</code> - 此关键字的值是 NIC 的
                MAC 地址。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">ATTR{type}=="1"</code> -
                此项确保此规则对于某些创建多个虚拟接口的无线驱动只匹配首要接口。跳过次要接口的原因和 VLAN
                以及子接口的原因相同：若不如此会出现冲突。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">KERNEL=="eth*"</code> - 此关键字添加到 Udev
                规则创建器以处理具有多个网络接口而且有相同的 MAC 地址的情况 (例如
                PS3).如果独立的接口有不同的基础名称，此关键字就将允许 Udev 区分它们。对于多数 LFS
                用户而言此项并不必须然而无害。
              </p>
            </li>
            <li>
              <p>
                <code class="literal">NAME</code> - 此关键字的值是 Udev 将会给此接口分配的名称。
              </p>
            </li>
          </ul>
        </div>
        <p>
          <code class="literal">NAME</code>
          的值是最重要的部分。在继续之前要确保你知道每个网卡的名称，在创建以下配置文件时使用这个 <code class=
          "literal">NAME</code> 值。
        </p>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          7.2.2. 创建网络接口配置文件
        </h2>
        <p>
          网络脚本开关的接口取决于 <code class="filename">/etc/sysconfig/</code>
          中的文件。要配置的每个接口在此目录中都应该有一个文件，例如 <code class=
          "filename">ifconfig.xyz</code>，其中 “<span class="quote">xyz</span>”
          应该是一个对管理员有意义的名称，如设备名 (比如 eth0)。此文件中是该接口的属性，例如 IP 地址、子网掩码等。文件名的主干必须是
          <span class="emphasis"><em>ifconfig</em></span>。
        </p>
        <p>
          以下命令会创建一个样例文件，给 <span class="emphasis"><em>eth0</em></span>
          设备分配一个静态 IP 地址：
        </p>
        <pre class="userinput">
<kbd class="command">cd /etc/sysconfig/
cat &gt; ifconfig.eth0 &lt;&lt; "EOF"
<code class="literal">ONBOOT=yes
IFACE=eth0
SERVICE=ipv4-static
IP=192.168.1.1
GATEWAY=192.168.1.2
PREFIX=24
BROADCAST=192.168.1.255</code>
EOF</kbd>
</pre>
        <p>
          这些变量的值在每个文件中都要改为正确设置的地址。
        </p>
        <p>
          如果 <code class="envar">ONBOOT</code> 变量设置为 “<span class=
          "quote">yes</span>”，网络脚本会在系统引导时打开该 NIC，否则网络脚本就会忽略之并且不会自动打开该
          NIC。该接口可以使用 <span class="command"><strong>ifup</strong></span> 和
          <span class="command"><strong>ifdown</strong></span> 命令来手动打开和关闭。
        </p>
        <p>
          <code class="envar">IFACE</code> 变量定义接口名称，例如 eth0。所有的网络设备配置文件都需要它。
        </p>
        <p>
          <code class="envar">SERVICE</code> 变量定义获取 IP 地址的方法。LFS-Bootscripts
          程序包有一个模块化的 IP 对应方法，在 <code class="filename">/lib/services/</code>
          目录中创建额外文件可以允许其他的 IP 对应directory allows other IP 对应方法。此项经常用于 DHCP，在
          BLFS 中提到。
        </p>
        <p>
          如果有网关，<code class="envar">GATEWAY</code> 变量应该包含默认网关的 IP
          地址，否则注释掉这整个变量。
        </p>
        <p>
          <code class="envar">PREFIX</code> 比啊量包含子网使用的位数。IP 地址中有 4 个 8
          位组。如果子网的掩码是 255.255.255.0，它就使用前 3 个 8 位组指定网络号。如果子网掩码是
          255.255.255.240，使用的就是前 28 位。超过 24 位的前缀通常被 DSL 和基于线电缆的 ISP 使用。这一例子
          (PREFIX=24) 中，子网掩码是 255.255.255.0。根据你的子网调节 <code class=
          "envar">PREFIX</code> 变量的值。如果忽略，其默认值为24。
        </p>
        <p>
          获取更多信息，参考 <span class="command"><strong>ifup</strong></span> 的手册页。
        </p>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          <a id="resolv.conf" name="resolv.conf"></a>7.2.3. 创建
          /etc/resolv.conf 文件
        </h2>
        <p>
          如果你的系统要连接到互联网，它需要一种 DNS 名称解析服务来解析互联网域名和 IP 地址，反之亦然。最佳实现方式是将 DNS
          服务器的 IP 地址 (从 ISP 或者网络管理员处获取) 置于 <code class=
          "filename">/etc/resolv.conf</code> 中。运行以下命令创建此文件：
        </p>
        <pre class="userinput">
<kbd class="command">cat &gt; /etc/resolv.conf &lt;&lt; "EOF"
<code class="literal"># Begin /etc/resolv.conf

domain <em class="replaceable"><code>&lt;domain&gt;</code></em>
nameserver <em class="replaceable"><code>&lt;address&gt;</code></em>
nameserver <em class="replaceable"><code>&lt;address&gt;</code></em>

# End /etc/resolv.conf</code>
EOF</kbd>
</pre>
        <p>
          <code class="varname">domain</code> 声明可以忽略或者以 <code class=
          "varname">search</code> 声明替换。参考 resolv.conf 的手册页获取更多细节。
        </p>
        <p>
          将 <em class="replaceable"><code>&lt;address&gt;</code></em> 替换为最适合的
          DNS 的 IP 地址。经常会有超过一个条目 (要求备选服务器有相关兼容性)。如果你只想要一个 DNS 服务器，移除文件中
          <span class="emphasis"><em>nameserver</em></span> 的第二行。该 IP
          地址可以是本地网络上的一台路由器。
        </p>
        <div class="admon note">
          <img alt="[注意]" src="../images/note.png" />
          <h3>
            注意
          </h3>
          <p>
            谷歌公开 IPv4 DNS 地址为 8.8.8.8 和 8.8.4.4。
          </p>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title="介绍">上一页</a>
          <p>
            介绍
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="hosts.html" title=
          "自定义 /etc/hosts 文件">下一页</a>
          <p>
            自定义 /etc/hosts 文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121118">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
