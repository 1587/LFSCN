<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.5.&nbsp;创建到设备的自定义符号链接
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20121103">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20121103
      </h4>
      <h3>
        第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="udev.html" title="LFS 系统上的设备和模块管理">上一页</a>
          <p>
            LFS 系统上的设备和模块管理
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="bootscripts.html" title=
          "LFS-Bootscripts-20121013">下一页</a>
          <p>
            LFS-Bootscripts-20121013
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121103">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-scripts-symlinks" name="ch-scripts-symlinks"></a>7.5.
        创建到设备的自定义符号链接
      </h1>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          7.5.1. CD-ROM 符号链接
        </h2>
        <p>
          你之后可能想要安装的某些软件 (例如各种媒体播放器) 期待 <code class=
          "filename">/dev/cdrom</code> 和 <code class=
          "filename">/dev/dvd</code> 这两个符号链接存在，并且指向一个 CD-ROM 或者 DVD-ROM
          设备。将这些符号链接的引用写入 <code class="filename">/etc/fstab</code> 文件可能会比较方便。
          Udev 带有一个脚本，会产生规则文件并依据每个设备的能力创建这些符号链接，但是你需要决定此脚本以两种操作模式中的哪一种进行工作。
        </p>
        <p>
          首先，此脚本可以工作于 “<span class="quote">by-path</span>” 模式下 (默认用于 USB
          和火线设备)，其创建的规则依赖到 CD 或 DVD 设备的物理路径。它也可一工作于 “<span class=
          "quote">by-id</span>” 模式下 (默认用于 IDE 和 SCSI 设备)，创建个规则依赖 CD 或 DVD
          设备本身存储的识别字符串。路径由 Udev 的 <span class=
          "command"><strong>path_id</strong></span> 脚本获知，识别字符串由 <span class=
          "command"><strong>ata_id</strong></span> 或者 <span class=
          "command"><strong>scsi_id</strong></span>
          程序从硬件中读取，具体使用哪一个取决于你的设备类型。
        </p>
        <p>
          两种方法都有各自的优点；正确的方法取决于可能发生的设备改动的种类。如果你认为到设备的物理路径 (也就是它占用的接口或者插槽)
          改变，例如你计划将驱动器移动到一个不同的 IDE 接口或者 USB 链接器，那么就应当使用 “<span class=
          "quote">by-id</span>”
          模式。另一方面，如果你认为设备的身份可能有改动，例如由于损坏而被一个相同功能的设备在同一连接器替换，那么就应当使用
          “<span class="quote">by-path</span>” 模式。
        </p>
        <p>
          如果你的驱动器可能会发生其中至少一种变动，基于你认为会相对经常发生的那一种来选择模式。
        </p>
        <div class="admon important">
          <img alt="[重要]" src="../images/important.png" />
          <h3>
            重要
          </h3>
          <p>
            外置设备 (例如 USB 接口的 CD 驱动器) 不应使用 “<span class=
            "quote">by-path</span>” 模式，因为每次设备被插入一个不同的接口，它的物理路径就会改变。Udev
            规则以物理路径识别的任何外置设备都会有这个问题，并不局限于 CD 和 DVD 驱动器。
          </p>
        </div>
        <p>
          如果你想要查看 Udev 脚本使用的值，那么对于一个 CD-ROM 驱动器，找到它在 <code class=
          "filename">/sys</code> 中对应的目录 (例如 <code class=
          "filename">/sys/block/hdd</code>) 并运行类似以下的命令：
        </p>
        <pre class="userinput">
<kbd class="command">udevadm test /sys/block/hdd</kbd>
</pre>
        <p>
          查看输出中包含 *_id 程序的行。如果存在并且非空，“<span class="quote">by-id</span>” 模式会使用
          ID_SERIAL 值，否则就会使用 ID_MODEL 和 ID_REVISION 的组合。“<span class=
          "quote">by-path</span>” 模式会使用 ID_PATH 值
        </p>
        <p>
          如果默认模式不适合你的情况，那么可以对 <code class=
          "filename">/lib/udev/rules.d/75-cd-aliases-generator.rules</code>
          文件进行以下修改 (其中 <em class="replaceable"><code>mode</code></em> 为
          “<span class="quote">by-id</span>” 或者 “<span class=
          "quote">by-path</span>”)：
        </p>
        <pre class="userinput">
<kbd class="command">sed -i -e 's/"write_cd_rules"/"write_cd_rules <em class=
"replaceable"><code>mode</code></em>"/' \
    /lib/udev/rules.d/75-cd-aliases-generator.rules</kbd>
</pre>
        <p>
          注意现在还不必创建规则文件或者符号链接，因为你在 LFS 系统中已经捆绑挂载了宿主的 <code class=
          "filename">/dev</code> 目录，我们假设宿主上存在这些符号链接。规则和符号链接会在首次引导 LFS 系统时创建。
        </p>
        <p>
          然而如果你有多个 CD-ROM 设备，那时创建的符号链接可能会指向与宿主上不同的设备，因为设备发现的顺序是不可预测的。首次引导 LFS
          系统时进行的分配会是稳定的，所以只有你需要两个设备上的符号链接指向相同设备时会是个问题。如果需要如此，在引导之后查看
          (很可能还要编辑) 创建的 <code class=
          "filename">/etc/udev/rules.d/70-persistent-cd.rules</code>
          文件，确保分配的符号链接与你所需要的匹配。
        </p>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          7.5.2. 处理重复设备
        </h2>
        <p>
          如同 <a class="xref" href="udev.html" title=
          "7.4.&nbsp;LFS 系统上的设备和模块管理">第&nbsp;7.4&nbsp;节 “LFS 系统上的设备和模块管理”</a>
          中解释的那样，具有相同功能的设备在 <code class="filename">/dev</code>
          中出现的顺序是随机的。例如，如果你有一个 USB 摄像头和一个电视调谐器，有时 <code class=
          "filename">/dev/video0</code> 会指向摄像头，<code class=
          "filename">/dev/video1</code>
          指向调谐器，有时在重新引导之后就会颠倒。除了声卡和网卡之外，这类问题都可以通过为自定义的固定符号链接创建 udev
          规则来解决。网卡的问题在 <a class="xref" href="network.html" title=
          "7.2.&nbsp;通用网络配置">第&nbsp;7.2&nbsp;节 “通用网络配置”</a> 中单独讨论，声卡的配置位于
          <a class="ulink" href=
          "http://www.linuxfromscratch.org/blfs/view/svn/postlfs/devices.html">
          BLFS</a> 中。
        </p>
        <p>
          对于你的每个可能出现此问题的设备 (即使该问题在你当前的 Linux 发行版上并不存在)，在 <code class=
          "filename">/sys/class</code> 或 <code class=
          "filename">/sys/block</code> 中找到对应的目录。对于视频设备可能是 <code class=
          "filename">/sys/class/video4linux/video<em class=
          "replaceable"><code>X</code></em></code>。找到能独立识别该设备的属性 (通常生产商、产品 ID
          和/或序列号即可)：
        </p>
        <pre class="userinput">
<kbd class="command">udevadm info -a -p /sys/class/video4linux/video0</kbd>
</pre>
        <p>
          然后写出创建符号链接的规则，例如：
        </p>
        <pre class="userinput">
<kbd class=
"command">cat &gt; /etc/udev/rules.d/83-duplicate_devs.rules &lt;&lt; "EOF"
<code class="literal">
# Persistent symlinks for webcam and tuner
KERNEL=="video*", ATTRS{idProduct}=="1910", ATTRS{idVendor}=="0d81", \
    SYMLINK+="webcam"
KERNEL=="video*", ATTRS{device}=="0x036f", ATTRS{vendor}=="0x109e", \
    SYMLINK+="tvtuner"
</code>
EOF</kbd>
</pre>
        <p>
          结果就是 <code class="filename">/dev/video0</code> 和 <code class=
          "filename">/dev/video1</code> 仍然随机指向调谐器和摄像头 (也就不能直接使用)，但是有
          <code class="filename">/dev/tvtuner</code> 和 <code class=
          "filename">/dev/webcam</code> 这两个符号链接始终指向正确的设备。
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="udev.html" title="LFS 系统上的设备和模块管理">上一页</a>
          <p>
            LFS 系统上的设备和模块管理
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="bootscripts.html" title=
          "LFS-Bootscripts-20121013">下一页</a>
          <p>
            LFS-Bootscripts-20121013
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;设置系统引导脚本">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121103">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
