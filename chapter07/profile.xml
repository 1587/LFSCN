<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-scripts-profile">
  <?dbhtml filename="profile.html"?>

  <title>Bash初始化文件</title>

  <indexterm zone="ch-scripts-profile">
    <primary sortas="e-/etc/profile">/etc/profile</primary>
  </indexterm>

  <para>Shell程序 <command>/bin/bash</command> （后面用 <quote>shell</quote> 来代替）使用一系列与启动相关的文件创建一个运行环境。每个文件在不同的方面影响登录设定和交互环境。在 <filename
  class="directory">/etc</filename> 文件夹中的文件提供全局设定。如果相同的设置文件存在于你的$HOME目录，那些文件会覆盖全局设定。</para>

  <para>一个登录 shell 会在使用 <command>/bin/login</command> 核对 <filename>/etc/passwd</filename> 文件中的用户信息，成功登陆后启动。一个非登录 shell 是从命令行启动的（例如，使用 直接执行 <command>/bin/bash</command>）。一个非登录 shell 总是在一个 shell 脚本执行时存在。他是非交互式的，因为它会执行一个脚本，不会等待用户输入命令。</para>

  <para>更多信息，查看 <command>info bash</command> 下的 <emphasis>Bash Startup Files and Interactive Shells</emphasis> 章节。</para>

  <para><filename>/etc/profile</filename> 文件和 <filename>~/.bash_profile</filename> 文件会在一个 shell 被当作一个登录 shell 时被读取。</para>

  <para><filename>/etc/profile</filename> 文件设置重要的环境变量来提供本地语言支持。通过设置它们，可以达成:</para>

  <itemizedlist>
    <listitem>
      <para>将一些程序的输出翻译成本地语言。</para>
    </listitem>
    <listitem>
      <para>正确的将字符分类成字母，数字，或者其它类别。这对 <command>bash</command> 正确处理非 ASCII 字符非常重要。</para>
    </listitem>
    <listitem>
      <para>根据国家不同进行合适的按字符排序。</para>
    </listitem>
    <listitem>
      <para>默认合适的页大小。</para>
    </listitem>
    <listitem>
      <para>正确的时间，日期和价格格式。</para>
    </listitem>
  </itemizedlist>

  <para>Replace <replaceable>&lt;ll&gt;</replaceable> below with the two-letter code
  for the desired language (e.g., <quote>en</quote>) and
  <replaceable>&lt;CC&gt;</replaceable> with the two-letter code for the appropriate
  country (e.g., <quote>GB</quote>). <replaceable>&lt;charmap&gt;</replaceable> should
  be replaced with the canonical charmap for your chosen locale. Optional
  modifiers such as <quote>@euro</quote> may also be present.</para>

  <para>The list of all locales supported by Glibc can be obtained by running
  the following command:</para>

<screen role="nodump"><userinput>locale -a</userinput></screen>

  <para>Charmaps can have a number of aliases, e.g., <quote>ISO-8859-1</quote>
  is also referred to as <quote>iso8859-1</quote> and <quote>iso88591</quote>.
  Some applications cannot handle the various synonyms correctly (e.g., require
  that <quote>UTF-8</quote> is written as <quote>UTF-8</quote>, not
  <quote>utf8</quote>), so it is safest in most
  cases to choose the canonical name for a particular locale. To determine
  the canonical name, run the following command, where <replaceable>&lt;locale
  name&gt;</replaceable> is the output given by <command>locale -a</command> for
  your preferred locale (<quote>en_GB.iso88591</quote> in our example).</para>

<screen role="nodump"><userinput>LC_ALL=<replaceable>&lt;locale name&gt;</replaceable> locale charmap</userinput></screen>

  <para>For the <quote>en_GB.iso88591</quote> locale, the above command
  will print:</para>

<screen><computeroutput>ISO-8859-1</computeroutput></screen>

  <para>This results in a final locale setting of <quote>en_GB.ISO-8859-1</quote>.
  It is important that the locale found using the heuristic above is tested prior
  to it being added to the Bash startup files:</para>

<screen role="nodump"><userinput>LC_ALL=&lt;locale name&gt; locale language
LC_ALL=&lt;locale name&gt; locale charmap
LC_ALL=&lt;locale name&gt; locale int_curr_symbol
LC_ALL=&lt;locale name&gt; locale int_prefix</userinput></screen>

  <para>The above commands should print the language name, the character
  encoding used by the locale, the local currency, and the prefix to dial
  before the telephone number in order to get into the country. If any of the
  commands above fail with a message similar to the one shown below, this means
  that your locale was either not installed in Chapter 6 or is not supported by
  the default installation of Glibc.</para>

<screen><computeroutput>locale: Cannot set LC_* to default locale: No such file or directory</computeroutput></screen>

  <para>If this happens, you should either install the desired locale using the
  <command>localedef</command> command, or consider choosing a different locale.
  Further instructions assume that there are no such error messages from
  Glibc.</para>

  <!-- FIXME: the xlib example will became obsolete real soon -->
  <para>Some packages beyond LFS may also lack support for your chosen locale. One
  example is the X library (part of the X Window System), which outputs the
  following error message if the locale does not exactly match one of the character
  map names in its internal files:</para>

<screen><computeroutput>Warning: locale not supported by Xlib, locale set to C</computeroutput></screen>

  <para>In several cases Xlib expects that the character map will be listed in
  uppercase notation with canonical dashes. For instance, "ISO-8859-1" rather
  than "iso88591". It is also  possible to find an appropriate specification by
  removing the charmap part of the locale specification.  This can be checked
  by running the <command>locale charmap</command> command in both locales.
  For example, one would have to change "de_DE.ISO-8859-15@euro" to
  "de_DE@euro" in order to get this locale recognized by Xlib.</para>

  <para>Other packages can also function incorrectly (but may not necessarily
  display any error messages) if the locale name does not meet their expectations.
  In those cases, investigating how other Linux distributions support your locale
  might provide some useful information.</para>

  <para>Once the proper locale settings have been determined, create the
  <filename>/etc/profile</filename> file:</para>

<screen><userinput>cat &gt; /etc/profile &lt;&lt; "EOF"
<literal># Begin /etc/profile

export LANG=<replaceable>&lt;ll&gt;_&lt;CC&gt;.&lt;charmap&gt;&lt;@modifiers&gt;</replaceable>

# End /etc/profile</literal>
EOF</userinput></screen>

  <para>The <quote>C</quote> (default) and <quote>en_US</quote> (the recommended
  one for United States English users) locales are different. <quote>C</quote>
  uses the US-ASCII 7-bit character set, and treats bytes with the high bit set
  as invalid characters. That's why, e.g., the <command>ls</command> command
  substitutes them with question marks in that locale. Also, an attempt to send
  mail with such characters from Mutt or Pine results in non-RFC-conforming
  messages being sent (the charset in the outgoing mail is indicated as <quote>unknown
  8-bit</quote>). So you can use the <quote>C</quote> locale only if you are sure that
  you will never need 8-bit characters.</para>

  <para>UTF-8 based locales are not supported well by many programs. 
  Work is in progress to document and, if possible, fix such problems, see
  <ulink url="&blfs-root;view/svn/introduction/locale-issues.html"/>.</para>

</sect1>
