<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      5.8.&nbsp;调节工具链
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20120322">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20120322
      </h4>
      <h3>
        第&nbsp;5&nbsp;章&nbsp;搭建临时系统
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="glibc.html" title="Glibc-2.14.1">上一页</a>
          <p>
            Glibc-2.14.1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="binutils-pass2.html" title=
          "Binutils-2.22 - 第二遍">下一页</a>
          <p>
            Binutils-2.22 - 第二遍
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "第&nbsp;5&nbsp;章&nbsp;搭建临时系统">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20120322">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-tools-adjusting" name="ch-tools-adjusting"></a>5.8. 调节工具链
      </h1>
      <p>
        现在临时的 C 库已经安装好了，在本章剩余部分编译的所有工具都应该链接至这些库。要实现这一点，交叉编译器的 specs
        文件需要修改以指向位于 <code class="filename">/tools</code> 的新的动态链接器。
      </p>
      <p>
        通过转储编译器的 “<span class="quote">specs</span>” 文件至一个会被默认找到的位置。然后应用一次简单的
        <span class="command"><strong>sed</strong></span> 替换来调节 Gcc
        使用的动态链接器。此处的目的是找到所有到 <code class="filename">/lib</code> 或者 64
        位兼容宿主系统上的 <code class="filename">/lib64</code> 中动态链接器的提及并调节它们指向
        <code class="filename">/tools</code> 中的新位置。
      </p>
      <p>
        为了准确，推荐使用复制粘贴方法来执行以下命令。一定要检查 specs
        文件以确定所有到动态链接器位置的提及都正确调节。如果需要，参考<a class="xref" href=
        "toolchaintechnotes.html" title="5.2.&nbsp;工具链技术注记">第&nbsp;5.2&nbsp;节
        “工具链技术注记”</a>中的动态链接器默认名称。
      </p>
      <pre class="userinput">
<kbd class=
"command">SPECS=`dirname $($LFS_TGT-gcc -print-libgcc-file-name)`/specs
$LFS_TGT-gcc -dumpspecs | sed \
  -e 's@/lib\(64\)\?/ld@/tools&amp;@g' \
  -e "/^\*cpp:$/{n;s,$, -isystem /tools/include,}" &gt; $SPECS 
echo "New specs file is: $SPECS"
unset SPECS</kbd>
</pre>
      <div class="admon caution">
        <img alt="[小心]" src="../images/caution.png" />
        <h3>
          小心
        </h3>
        <p>
          在这里，停下来确保新工具链的基本功能 (编译和链接) 能正常工作很重要。要进行完整性检查，运行以下命令：
        </p>
        <pre class="userinput">
<kbd class="command">echo 'main(){}' &gt; dummy.c
$LFS_TGT-gcc -B/tools/lib dummy.c
readelf -l a.out | grep ': /tools'</kbd>
</pre>
        <p>
          如果一切工作正常，就不会出现错误，最后一条命令的输出会符合以下格式：
        </p>
        <pre class="screen">
<code class=
"computeroutput">[Requesting program interpreter: /tools/lib/ld-linux.so.2]</code>
</pre>
        <p>
          留意 <code class="filename">/tools/lib</code> 或者 64 位计算机上的
          <code class="filename">/tools/lib64</code> 作为动态链接器的前缀出现。
        </p>
        <p>
          如果输出不如上文所示或者根本没有输出，那就有什么地方出错了。研究回溯刚才的步骤，查出问题并修正它。在继续之前必须解决这一问题。可能在刚才的
          specs 文件修改过程中出现了问题。如果出现了这种情况，重做 specs 文件修改，小心地复制粘贴命令。
        </p>
        <p>
          一切正常之后，清理测试文件：
        </p>
        <pre class="userinput">
<kbd class="command">rm -v dummy.c a.out</kbd>
</pre>
      </div>
      <div class="admon note">
        <img alt="[注意]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          下一节中编制 Binutils 相当与额外检查了一次工具链是否正常编制。如果 Binutils 编制失败，就说名之前的
          Binutils、GCC 或 Glibc 安装出现了问题。
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="glibc.html" title="Glibc-2.14.1">上一页</a>
          <p>
            Glibc-2.14.1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="binutils-pass2.html" title=
          "Binutils-2.22 - 第二遍">下一页</a>
          <p>
            Binutils-2.22 - 第二遍
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "第&nbsp;5&nbsp;章&nbsp;搭建临时系统">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20120322">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
