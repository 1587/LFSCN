<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      8.4.&nbsp;使用 GRUB 设置引导过程
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20121203">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20121203
      </h4>
      <h3>
        第&nbsp;8&nbsp;章&nbsp;使 LFS 系统可以引导
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="kernel.html" title="Linux-3.6.8">上一页</a>
          <p>
            Linux-3.6.8
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../chapter09/chapter09.html" title=
          "结束">下一页</a>
          <p>
            结束
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "第&nbsp;8&nbsp;章&nbsp;使 LFS 系统可以引导">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121203">起始页</a>
        </li>
      </ul>
    </div>
    <div class="wrap" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-bootable-grub" name="ch-bootable-grub"></a>8.4. 使用 GRUB
        设置引导过程
      </h1>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          8.4.1. 介绍
        </h2>
        <div class="admon warning">
          <img alt="[警告]" src="../images/warning.png" />
          <h3>
            警告
          </h3>
          <p>
            配置 GRUB 出错会导致你的系统如果没有替代引导设备 (如 CD-ROM) 就无法操作。本节并不是引导你的 LFS
            系统必须的。修改当前的引导加载奇，例如 Grub-Legacy、GRUB2 或者 LILO 都可以。
          </p>
        </div>
        <p>
          确保有一个紧急引导磁盘可以用于在无法使用 (实际上是无法引导) “<span class="quote">恢复</span>”
          计算机。如果你现在没有引导设备，可以创建一个。要让以下过程工作，请跳至 BLFS 中，安装 <a class="ulink"
          href="http://www.linuxfromscratch.org/blfs/view/svn/multimedia/libisoburn.html">
          libisoburn</a> 程序包中的 <span class=
          "command"><strong>xorriso</strong></span>。
        </p>
        <pre class="userinput">
<kbd class="command">cd /tmp &amp;&amp;
grub-mkrescue --output=grub-img.iso &amp;&amp;
xorriso -as cdrecord -v dev=/dev/cdrw blank=as_needed grub-img.iso</kbd>
</pre>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          8.4.2. GRUB 名称转换
        </h2>
        <p>
          GRUB 使用自己的名称结构命名驱动器和分区，格式为 <span class=
          "emphasis"><em>(hdn,m)</em></span>，其中 <span class=
          "emphasis"><em>n</em></span> 是硬盘驱动器编号，<span class=
          "emphasis"><em>m</em></span> 是分区编号。硬盘驱动器编号从 0 开始，但主分区的分区编号从 1
          开始，扩展分区从 5 开始。注意这与早期版本中两个编号都从 0 开始是不同的。例如 <code class=
          "filename">sda1</code> 分区对 GRUB 来说是 <span class=
          "emphasis"><em>(hd0,1)</em></span> 而 <code class=
          "filename">sdb3</code> 就是 <span class=
          "emphasis"><em>(hd1,3)</em></span>。与 Linux 不同，GRUB 不把 CD-ROM
          驱动器认作硬盘驱动器。例如，如果在 <code class="filename">hdb</code> 上使用 CD，第二硬盘驱动器是
          <code class="filename">hdc</code>，那么第二硬盘驱动器仍然会是 <span class=
          "emphasis"><em>(hd1)</em></span>。
        </p>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          8.4.3. 建立配置
        </h2>
        <p>
          GRUB 通过向硬盘的第一物理磁道写入数据来工作。这个区域不属于任何一个文件系统。其中的程序访问引导分区中的 GRUB
          模块。默认的路径是 <code class="filename">/boot/grub/</code>。
        </p>
        <p>
          引导分区的位置是用户的选择，将会影响配置。一个推荐是分出一个小的分区 (建议为 100 MB) 用于引导信息，这样每个编制，无论是
          LFS 还是商业发行版都可以访问同样的引导文件，在任何一个引导了的系统都可以访问。若要如此做，你需要挂载这个独立的分区，将当前
          <code class="filename">/boot</code> 目录中的所有文件 (例如上一节中编制的 Linux 内核)
          移动到新的分区中。然后你需要卸载这个分区，并重新挂载为 <code class=
          "filename">/boot</code>。若如此做，请确保修改 <code class=
          "filename">/etc/fstab</code>。
        </p>
        <p>
          使用当前的 LFS 分区也能够工作，但是要配置多个系统会更加困难。
        </p>
        <p>
          使用以上的信息，获取正确的根分区 (如果有，应该为引导分区) 的名称。在以下的例子中，假设根分区 (或者独立的引导分区) 是
          <code class="filename">sda2</code>.
        </p>
        <p>
          安装 GRUB 文件到 <code class="filename">/boot/grub</code> 并建立引导磁道：
        </p>
        <div class="admon warning">
          <img alt="[警告]" src="../images/warning.png" />
          <h3>
            警告
          </h3>
          <p>
            以下命令会重写当前的引导加载器。如果不想如此 (例如使用了第三方引导加载器管理 MBR)，请不要运行。
          </p>
        </div>
        <pre class="userinput">
<kbd class="command">grub-install /dev/sda</kbd>
</pre>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          8.4.4. 创建配置文件
        </h2>
        <p>
          生成 <code class="filename">/boot/grub/grub.cfg</code>：
        </p>
        <pre class="userinput">
<kbd class="command">cat &gt; /boot/grub/grub.cfg &lt;&lt; "EOF"
<code class="literal"># Begin /boot/grub/grub.cfg
set default=0
set timeout=5

insmod ext2
set root=(hd0,2)

menuentry "GNU/Linux, Linux 3.6.8-lfs-SVN-20121203" {
        linux   /boot/vmlinuz-3.6.8-lfs-SVN-20121203 root=/dev/sda2 ro
}</code>
EOF</kbd>
</pre>
        <div class="admon note">
          <img alt="[注意]" src="../images/note.png" />
          <h3>
            注意
          </h3>
          <p>
            从 <span class="application">GRUB</span>
            的角度来看，内核文件是相对于使用的分区存在的。如果你使用了独立的引导分区，从以上的 <span class=
            "emphasis"><em>linux</em></span> 一行移除 <code class=
            "filename">/boot</code>。你还需要修改 <span class="emphasis"><em>set
            root</em></span> 一行指向引导分区。
          </p>
        </div>
        <p>
          GRUB 是异常强大的程序，提供海量的选项用于引导各种设备、操作系统和分区类型。还有很多可以自定义的选项，包括图形 splash
          screen、播放声音、鼠标输入等。这些选项的细节在此不讨论。
        </p>
        <div class="admon caution">
          <img alt="[小心]" src="../images/caution.png" />
          <h3>
            小心
          </h3>
          <p>
            有一个命令 <span class="command"><strong>grub-mkconfig</strong></span>
            能自动创建配置文件。它使用 <code class="filename">/etc/grub.d/</code>
            中的一系列脚本，并且会毁掉你的所有自定义配置。这些脚本是为不基于源代码的发行版设计的，不推荐用于 LFS。如果你安装了商业
            Linux 发行版，这个程序很可能会运行。记得备份你的 <code class=
            "filename">grub.cfg</code> 文件。
          </p>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="kernel.html" title="Linux-3.6.8">上一页</a>
          <p>
            Linux-3.6.8
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../chapter09/chapter09.html" title=
          "结束">下一页</a>
          <p>
            结束
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "第&nbsp;8&nbsp;章&nbsp;使 LFS 系统可以引导">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20121203">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
