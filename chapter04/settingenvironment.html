<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      4.4.&nbsp;设置工作环境
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="lfs" id="lfs-SVN-20120415">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 SVN-20120415
      </h4>
      <h3>
        第&nbsp;4&nbsp;章&nbsp;最后的准备
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="addinguser.html" title="添加 LFS 用户">上一页</a>
          <p>
            添加 LFS 用户
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="aboutsbus.html" title="关于 SBU">下一页</a>
          <p>
            关于 SBU
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter04.html" title=
          "第&nbsp;4&nbsp;章&nbsp;最后的准备">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20120415">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-tools-settingenviron" name=
        "ch-tools-settingenviron"></a>4.4. 设置工作环境
      </h1>
      <p>
        给 <span class="command"><strong>bash</strong></span> shell
        创建两个新的起始文件来创建一个好的工作环境。作为用户 <code class="systemitem">lfs</code>
        登录后运行以下命令来创建新的 <code class="filename">.bash_profile</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; ~/.bash_profile &lt;&lt; "EOF"
<code class=
"literal">exec env -i HOME=$HOME TERM=$TERM PS1='\u:\w\$ ' /bin/bash</code>
EOF</kbd>
</pre>
      <p>
        作为用户 <code class="systemitem">lfs</code> 登录时，初始 shell
        通常是一个<span class="emphasis"><em>登录</em></span> shell，会先读取宿主的
        <code class="filename">/etc/profile</code> 文件 (可能包含一些设置和环境变量) 然后是
        <code class="filename">.bash_profile</code>。<code class=
        "filename">.bash_profile</code> 文件中的 <span class=
        "command"><strong>exec env -i.../bin/bash</strong></span>
        这条命令用全空的环境替换运行中的 shell，只保留 <code class=
        "envar">HOME</code>、<code class="envar">TERM</code> 和 <code class=
        "envar">PS1</code>
        变量。这样就确保了不会有不想要的或有千载威海的环境变量从宿主系统泄漏到编制环境中。这样就实现了确保环境干净的目标。
      </p>
      <p>
        新的 shell 是<span class="emphasis"><em>非登录</em></span> shell，不读
        <code class="filename">/etc/profile</code> 和 <code class=
        "filename">.bash_profile</code> 这两个文件，而去读 <code class=
        "filename">.bashrc</code> 文件。现在创建 <code class=
        "filename">.bashrc</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; ~/.bashrc &lt;&lt; "EOF"
<code class="literal">set +h
umask 022
LFS=/mnt/lfs
LC_ALL=POSIX
LFS_TGT=$(uname -m)-lfs-linux-gnu
PATH=/tools/bin:/bin:/usr/bin
export LFS LC_ALL LFS_TGT PATH</code>
EOF</kbd>
</pre>
      <p>
        <span class="command"><strong>set +h</strong></span> 命令关闭
        <span class="command"><strong>bash</strong></span> 的哈希功能。哈希通常是很有用的功能
        —<span class="command"><strong>bash</strong></span>
        使用哈希表来记忆可执行文件的完整路径以防每次为了同样的可执行文件搜索 <code class=
        "envar">PATH</code>。然而，新的工具应该一旦安装就被使用。通过关闭哈希功能，shell 在要运行程序的时候就总会搜索
        <code class="envar">PATH</code>。这样，shell 就会找到 <code class=
        "filename">$LFS/tools</code> 中新编译的工具而不会记住另外一个位置的以前版本的相同程序。
      </p>
      <p>
        设置用户的文件创建蒙版为 022 可以确保新创建的文件和目录只有所有者可写，但对所有人可读可执行 (假定 <code class=
        "function">open(2)</code> 系统调用默认模式，新文件最后会带上权限模式644，新文件夹为755)。
      </p>
      <p>
        <code class="envar">LFS</code> 变量应设置为选定的挂载点。
      </p>
      <p>
        <code class="envar">LC_ALL</code>
        变量控制某些程序的本地化，使得它们的消息遵从特定国家的规则。如果宿主系统使用的 Glibc 版本晚于 2.2.4，把
        <code class="envar">LC_ALL</code> 设置为不是 “<span class=
        "quote">POSIX</span>” 或者 “<span class="quote">C</span>” (这一章) 的值在退出
        chroot 环境然后重新进入时可能产生问题。设置 <code class="envar">LC_ALL</code> 为
        “<span class="quote">POSIX</span>” 或 “<span class="quote">C</span>”
        (两者等价) 确保在 chroot 环境中一切都正常工作。
      </p>
      <p>
        <code class="envar">LFS_TGT</code>
        变量设置一个非默认但兼容的计算机描述，用在编制交叉编译器和链接器并交叉编译我们的临时工具链的时候。更多信息位于<a class=
        "xref" href="../chapter05/toolchaintechnotes.html" title=
        "5.2.&nbsp;工具链技术注记">第&nbsp;5.2&nbsp;节 “工具链技术注记”</a>。
      </p>
      <p>
        通过把 <code class="filename">/tools/bin</code> 放在标准 <code class=
        "envar">PATH</code> 之前，<a class="xref" href=
        "../chapter05/chapter05.html" title=
        "第&nbsp;5&nbsp;章&nbsp;搭建临时系统">第五章</a>中安装的所有程序在安装过后就会立刻被 shell
        找到。此项与关闭哈希联用，就限制了第五章环境中有程序却使用宿主程序的风险。
      </p>
      <p>
        最后，为了完成编制临时工具的环境，把刚创建的用户配置文件 source 一下：
      </p>
      <pre class="userinput">
<kbd class="command">source ~/.bash_profile</kbd>
</pre>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="addinguser.html" title="添加 LFS 用户">上一页</a>
          <p>
            添加 LFS 用户
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="aboutsbus.html" title="关于 SBU">下一页</a>
          <p>
            关于 SBU
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter04.html" title=
          "第&nbsp;4&nbsp;章&nbsp;最后的准备">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 SVN-20120415">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
